<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOQ Tracker</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
</head>

<body class="bg-gradient-to-r from-[#e9f9fd] to-[#faffff] text-gray-800">
  <header class="bg-gradient-to-r from-[#3477ff] to-[#5dc6ff] text-white py-4 shadow">
    <h1 class="text-center text-2xl font-semibold tracking-wide">Bill of Quantity </h1>
  </header>

<div class="max-w-6xl mx-auto p-6">

  <!-- Site Details -->
  <div class="bg-white rounded-xl shadow p-6 mb-6">
    <h2 class="text-lg font-semibold mb-4">Site Details</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <input id="userName" placeholder="Name of Incharge" class="border p-2 rounded">
      <input id="siteName" placeholder="Site Name" class="border p-2 rounded">
    </div>
  </div>

  <!-- Add Material -->
  <div class="bg-white rounded-xl shadow p-6 mb-6">
    <h2 class="text-lg font-semibold mb-4">Add Material</h2>
    <div class="grid md:grid-cols-6 gap-3">
      <select id="spec" class="border p-2 rounded">
        <option value="">Specification</option>
        <option>Hose Nipple</option>
        <option>Hose Clip</option>
        <option>Hose Pipe</option>
        <option>FTA</option>
        <option>Ball Valve</option>
        <option>NRV Union Type</option>
        <option>Tee</option>
        <option>Elbow</option>
        <option>Reducer Tee</option>
        <option>Reducing Tee</option>
        <option>Coupling</option>
        <option>End Cap</option>
        <option>Union</option>
        <option>MTA</option>
        <option>NRV</option>
        <option>Pipe</option>
        <option>Butterfly Valve</option>
        <option>Flange</option>
        <option>Socket</option>
        <option>Tank Nipple</option>
        <option>Thunder Hose</option>
        <option>Braided Hose</option>
      </select>

      <select id="size" class="border p-2 rounded">
        <option value="">Size</option>
        <option>¼"</option><option>½"</option><option>¾"</option>
        <option>1"</option><option>1¼"</option><option>1½"</option>
        <option>2"</option><option>2½"</option><option>3"</option>
        <option>4"</option><option>5"</option><option>6"</option><option>8"</option><option>10"</option>
      </select>

      <select id="moc" class="border p-2 rounded">
        <option value="">MOC</option>
        <option>PVC</option>
            <option>UPVC</option>
            <option>SS304</option>
            <option>SS316</option>
            <option>GI</option>
            <option>CPVC</option>
            <option>CI</option>
            <option>Brass</option>
      </select>

      <input id="qty" type="number" placeholder="Qty" class="border p-2 rounded">

      <select id="unit" class="border p-2 rounded">
        <option value="">Unit</option>
        <option>Nos</option>
        <option>Meter</option>
      </select>

      <button id="addBtn" class="bg-blue-600 text-white rounded p-2">Add</button>
    </div>
  </div>

  <!-- Table -->
  <div class="bg-white rounded-xl shadow p-6">
    <div class="flex justify-between mb-4">
      <h2 class="text-lg font-semibold">Material List</h2>
      <div class="space-x-2">
        <button id="excelBtn" class="bg-green-600 text-white px-4 py-1 rounded">
          Export Excel
        </button>
        <button id="pdfBtn" class="bg-red-600 text-white px-4 py-1 rounded">
          Export PDF
        </button>
      </div>
    </div>

    <table class="w-full border text-sm">
      <thead class="bg-blue-100">
        <tr>
          <th class="border p-2">Sr</th>
          <th class="border p-2">Specification</th>
          <th class="border p-2">Size</th>
          <th class="border p-2">MOC</th>
          <th class="border p-2">Qty</th>
          <th class="border p-2">Unit</th>
          <th class="border p-2">Action</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script>
const addBtn = document.getElementById("addBtn");
const tableBody = document.getElementById("tableBody");
const excelBtn = document.getElementById("excelBtn");
const pdfBtn = document.getElementById("pdfBtn");

let materials = JSON.parse(localStorage.getItem("boqData")) || [];

function renderTable() {
  tableBody.innerHTML = "";
  materials.forEach((m, i) => {
    tableBody.innerHTML += `
      <tr>
        <td class="border p-2">${i + 1}</td>
        <td class="border p-2">${m.spec}</td>
        <td class="border p-2">${m.size}</td>
        <td class="border p-2">${m.moc}</td>
        <td class="border p-2">${m.qty}</td>
        <td class="border p-2">${m.unit}</td>
        <td class="border p-2 text-center">
          <button onclick="deleteRow(${i})" class="text-red-600">Delete</button>
        </td>
      </tr>`;
  });
  localStorage.setItem("boqData", JSON.stringify(materials));
}

function deleteRow(i) {
  materials.splice(i, 1);
  renderTable();
}

addBtn.onclick = () => {
  if (!spec.value || !size.value || !moc.value || !qty.value || !unit.value) {
    alert("Fill all fields");
    return;
  }
  materials.push({
    spec: spec.value,
    size: size.value,
    moc: moc.value,
    qty: qty.value,
    unit: unit.value
  });
  renderTable();
  document.querySelectorAll("select,input").forEach(e => e.value = "");
};

/* ✅ EXCEL WITH TABLE DESIGN */
excelBtn.onclick = () => {
  let html = `
  <table border="1">
    <tr>
      <th colspan="6" style="font-size:18px;padding:10px;">
        BOQ TRACKER REPORT
      </th>
    </tr>
    <tr><td colspan="6"></td></tr>
    <tr>
      <td><b>Name of Incharge</b></td>
      <td colspan="5">${userName.value}</td>
    </tr>
    <tr>
      <td><b>Site Name</b></td>
      <td colspan="5">${siteName.value}</td>
    </tr>
    <tr><td colspan="6"></td></tr>
    <tr style="background:#dbeafe;font-weight:bold;">
      <td>Sr No</td>
      <td>Specification</td>
      <td>Size</td>
      <td>MOC</td>
      <td>Quantity</td>
      <td>Unit</td>
    </tr>`;

  materials.forEach((m, i) => {
    html += `
    <tr>
      <td>${i + 1}</td>
      <td>${m.spec}</td>
      <td>${m.size}</td>
      <td>${m.moc}</td>
      <td>${m.qty}</td>
      <td>${m.unit}</td>
    </tr>`;
  });

  html += `</table>`;

  const blob = new Blob([html], { type: "application/vnd.ms-excel" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "BOQ_Tracker.xls";
  link.click();
};

/* PDF */
pdfBtn.onclick = () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("BOQ Tracker", 14, 10);
  doc.text(`Incharge: ${userName.value}`, 14, 18);
  doc.text(`Site: ${siteName.value}`, 14, 26);

  doc.autoTable({
    startY: 32,
    head: [["Sr","Specification","Size","MOC","Qty","Unit"]],
    body: materials.map((m,i)=>[i+1,m.spec,m.size,m.moc,m.qty,m.unit])
  });
  doc.save("BOQ_Tracker.pdf");
};

renderTable();
</script>

</body>
</html>
